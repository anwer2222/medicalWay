var g_stopWatch;function scrollImg(){setTimeout(function(){$("#conversation").getNiceScroll().resize()},400)}function stopWatch(e,t,n){var o,a,s=e;g_stopWatch=setInterval(function(){o=parseInt(s/60,10),a=parseInt(s%60,10),o=o<10?"0"+o:o,a=a<10?"0"+a:a,t.textContent=o+":"+a,--s<0&&n()},1e3)}function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+1e3*n);var a="expires="+o.toUTCString();document.cookie=e+"="+t+";"+a+";path=/;SameSite=None; Secure"}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function eraseCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function setStorageKeyValue(e,t){if("undefined"==window.localStorage)return!1;window.localStorage.setItem(e,t)}function getStorageKeyValue(e){return"undefined"!=window.localStorage&&window.localStorage.getItem(e)}function setStorageKeyObject(e,t){if("undefined"==window.localStorage)return!1;window.localStorage.setItem(e,JSON.stringify(t))}function getStorageKeyObject(e){return"undefined"!=window.localStorage&&JSON.parse(window.localStorage.getItem(e))}function setTimeStampStorageKey(e,t){try{if("undefined"==window.localStorage)return!1}catch(e){return!1}t?window.localStorage.setItem(e,(new Date).getTime()):window.localStorage.removeItem(e)}function getTimeStampStorageKey(e){try{if("undefined"==window.localStorage)return!1}catch(e){return!1}var t=window.localStorage.getItem(e);if(null==t)return!1;var n=(new Date).getTime();return!(Math.abs(n-t)/1e3>120)||(window.localStorage.removeItem(e),!1)}!function(e){void 0===e.Bots&&(e.Bots=function(){var e,t="/api/bot/Start",n="/api/bot/Ask",o="/api/bot/GetUrlResponse",a="/api/bot/TriggerCsSurvey",s="/Department/GetChatbotDepartments/",i="/Widget/UpdateUserLog/",r=void 0,c="",l={projectId:"",userId:"",connectedWithHub:!1,welcome:!1,targetDepartment:"default",connectionMode:"bot",connectedAgentId:void 0,reConnect:!1,_events:{},currentUtteranceWelcome:!1};function d(e,t){function n(e){$.get(s+l.projectId,function(t){1==t.status&&null!=t.departments?Bots.departments=t.departments:2==t.status&&null!=t.departments?Bots.departments=t.departments:(Bots.departments=[],Bots.departments.push({_id:"default",names:[{value:"default",lang:e}]})),l._invokeEventCallbacks("display-department",t,e)}).fail(function(){l._invokeEventCallbacks("net-connection-error")})}(r=$.connection.clientsHub).client.addNewMessageToPage=function(e,t){l._invokeEventCallbacks("add-message",t)},r.client.startRoom=function(e,t){l.connectionMode="agent",l.connectedAgentId=e,setTimeStampStorageKey("requestAgent",!1),setTimeStampStorageKey("connected",!0),l.reConnect?(l.callWelcome(l.reConnect),l.reConnect=!1):l._invokeEventCallbacks("start-room",t)},r.client.roomClosed=function(e){$.connection.hub.stop(),l.connectionMode="bot",l.connectedWithHub=!1,setTimeStampStorageKey("connected",!1),l._invokeEventCallbacks("close-room",e),$.ajax({type:"POST",url:a,dataType:"json",headers:{"X-Auth":l.authToken},data:{id:l.projectId,userId:l.userId,message:""},success:function(e){l.currentUtteranceWelcome&&(-1==e.indexOf("SYS_BUSY")&&(l.welcome=!0),l.currentUtteranceWelcome=!1),l._invokeEventCallbacks("handle-reponse",e,!1)},fail:function(){l._invokeEventCallbacks("net-connection-error")}})},r.client.roomClosedAndRequestCreated=function(e){l.connectionMode="bot",setTimeStampStorageKey("connected",!1),l._invokeEventCallbacks("close-new-request",e)},r.client.agentDisconnect=function(e,t){l.connectionMode="waiting",l._invokeEventCallbacks("room-diconnect",t)},r.client.requestAdded=function(e){setTimeStampStorageKey("requestAgent",!0),l._invokeEventCallbacks("request-added",e)},r.client.requestRejected=function(e){setTimeStampStorageKey("request-rejected",e),l._invokeEventCallbacks("request-rejected",e)},r.client.agentNotAvaliable=function(e){$.connection.hub.stop(),l.connectionMode="bot",l.connectedWithHub=!1,setTimeStampStorageKey("requestAgent",!1),l._invokeEventCallbacks("agent-not-avaliable",e)},l.connectedWithHub?e||n(t):$.connection.hub.start().done(function(){if(l.connectedWithHub=!0,e){var o=getStorageKeyObject("client-department");null!=o&&(l.targetDepartment=o),r.server.connect(l.userId,l.targetDepartment,l.projectId)}else n(t)}),l._invokeEventCallbacks("agent-try-connect")}function u(e,t){var n=[],o=e.length,a=t.length;if(0==o)return a;if(0==a)return o;for(var s=o;s>=0;s--)n[s]=[];for(s=o;s>=0;s--)n[s][0]=s;for(var i=a;i>=0;i--)n[0][i]=i;for(s=1;s<=o;s++){var r=e.charAt(s-1);for(i=1;i<=a;i++){if(s==i&&n[s][i]>4)return o;var c=t.charAt(i-1),l=r==c?0:1,d=n[s-1][i]+1,u=n[s][i-1]+1,g=n[s-1][i-1]+l;u<d&&(d=u),g<d&&(d=g),n[s][i]=d,s>1&&i>1&&r==t.charAt(i-2)&&e.charAt(s-2)==c&&(n[s][i]=Math.min(n[s][i],n[s-2][i-2]+l))}}return n[o][a]}function g(){$.get(o,{id:l.projectId,userId:l.userId,message:c},function(e){l._invokeEventCallbacks("handle-tracked-url",e)})}return l.init=function(e,t,n){l.userId=e,l.projectId=t,l.authToken=n,l.lang="ar",l.param=null;var o=getTimeStampStorageKey("connected"),a=getTimeStampStorageKey("requestAgent");(o||a)&&(l.reConnect=!0,d(l.reConnect,"ar"));var s=getCookie("botParam");""!=s&&(l.param=s)},l.sendMessage=function(e){!function(e,t){if(new Date,"department"!=l.connectionMode){if("agent"==l.connectionMode&&!t)return $("#msg_input").prop("disabled",!1),o=e,void(l.connectedAgentId&&r.server.send(l.userId,o,l.projectId));var o;l.currentUtteranceWelcome&&l._invokeEventCallbacks("clear-conversation");var a="";if(null!=l.param){var s,i=JSON.parse(l.param);for(s in i)a+=s+"##"+i[s]+"@@"}$.ajax({type:"POST",url:n,dataType:"json",headers:{"X-Auth":l.authToken},data:{id:l.projectId,userId:l.userId,message:e,param:a},success:function(e){l.currentUtteranceWelcome&&(-1==e.indexOf("SYS_BUSY")&&(l.welcome=!0),l.currentUtteranceWelcome=!1),l.param=null,eraseCookie("botParam"),l._invokeEventCallbacks("handle-reponse",e,t)},fail:function(){l._invokeEventCallbacks("net-connection-error")}})}else!function(e){var t,n="",o="",a=-1;if("string"!=typeof(t=e)||isNaN(t)||isNaN(parseFloat(t))){for(var s=100,i=0;i<Bots.departments.length;i++)for(var r=0;r<Bots.departments[i].names.length;r++){var c=u(e,Bots.departments[i].names[r].value);(c/=Bots.departments[i].names[r].value.length)<s&&(s=c,a=i)}if(-1==a)return;n=Bots.departments[a]._id,o=Bots.departments[a].names[0].value}else{if((a=parseInt(e))<1||a>Bots.departments.length)return;n=Bots.departments[a-1]._id,o=Bots.departments[a-1].names[0].value}Bots.connectWithAgent(n,o)}(e)}(e,!1)},l.trackURL=function(t){c=t,clearTimeout(e),e=setTimeout(g,5e3)},l.customerService=function(e,t){d(!1,t)},l.setParameter=function(e){l.param=e,setCookie("botParam",e,600)},l.getAlawwalUser=function(){return""},l.callWelcome=function(e){l.welcome||(l.currentUtteranceWelcome=!0,$("#msg_input").prop("disabled",!0),function(e){new Date,l.currentUtteranceWelcome&&l._invokeEventCallbacks("clear-conversation");var n="";if(null!=l.param){var o,a=JSON.parse(l.param);for(o in a)n+=o+"##"+a[o]+"@@"}$.ajax({type:"POST",url:t,dataType:"json",headers:{"X-Auth":l.authToken},data:{id:l.projectId,userId:l.userId,message:"welcome",lang:l.lang,param:n},success:function(t){l.currentUtteranceWelcome&&(-1==t.indexOf("SYS_BUSY")&&(l.welcome=!0),l.currentUtteranceWelcome=!1),l.param=null,eraseCookie("botParam"),l._invokeEventCallbacks("handle-reponse",t,e)},fail:function(){l._invokeEventCallbacks("net-connection-error")}})}(e),$.post(i,{userId:l.userId,chatbotId:l.projectId},function(e){e.status}).fail(function(){}))},l.connectWithAgent=function(e,t){l.targetDepartment={id:e,name:t},setStorageKeyObject("client-department",l.targetDepartment),l.connectionMode="waiting",l.connectedWithHub&&r.server.connect(l.userId,l.targetDepartment,l.projectId)},l.closeCSConversation=function(){l.connectedWithHub&&r.server.closeRoom(l.userId,l.projectId)},l.on=function(e,t){this._addEventCallback(e,t)},l._addEventCallback=function(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)},l._getEventCallbacks=function(e){return this._events.hasOwnProperty(e)?this._events[e]:[]},l._invokeEventCallbacks=function(e){var t=[],n=this._getEventCallbacks(e);Array.prototype.push.apply(t,arguments),t=t.slice(1);for(var o=0;o<n.length;o+=1)n[o].apply(null,t)},l}(),e.onbeforeunload=function(){getTimeStampStorageKey("connected")&&setTimeStampStorageKey("connected",!0)})}(window),$(function(){var e=!1,t=!1,n=0,o=24.59734006950007,a=46.7090454482916,s=!1,i=document.getElementById("userId").value,r=document.getElementById("chatbotId").value,c=document.getElementById("tokenId").value,l=document.getElementById("webviewMode");null!=l&&l.value;var d="#3d3d3e";171==r?d="#67ca28":172==r?d="#11af79":147==r?d="#1b429a":150==r&&(d="#5333a7");$("#conversation").niceScroll({cursorborder:"",cursorborderradius:0,cursorwidth:5,cursorcolor:d,boxzoom:!1,background:"#14141400",railalign:"left",autohidemode:"leave"});function u(e){o=e.coords.latitude,a=e.coords.longitude}function g(e){}function m(){var e=document.getElementById("conversation");e.scrollTop=e.scrollHeight-e.clientHeight}function p(){var e=document.getElementById("conversation"),t=document.getElementById("msg_block"),o=t.scrollHeight-n;o>e.clientHeight-110?e.scrollTop=e.scrollHeight-o-110:e.scrollTop=e.scrollHeight-o,n=t.scrollHeight}function v(e,t,n,o){null==o&&(o="ar"),"receiver"==n&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"));var a='<div  class="row message-body"> <div class="col-sm-12 message-main-'+n+'"> <div class="'+n+'"> <div class="message-text '+o+'">'+e+' </div> <div class="message-time"> '+t+"</div></div></div></div>";$("#msg_block").append(a)}function h(){$("#msg_block").append('<div  class="row message-body" id="typingIndicatorId"><div class="col-sm-12 message-main-sender"><div class="sender"><div class="typingIndicatorContainer"><div class="typingIndicatorBubble"><div class="typingIndicatorBubbleDot"></div> <div class="typingIndicatorBubbleDot"></div><div class="typingIndicatorBubbleDot"></div></div></div></div></div></div>')}function f(e,t,n){var o='<div  class="row message-body"> <div class="col-sm-12 message-main-'+n+'"> <div class="'+n+'"> <div id="showMapId" class="message-text geolocation mouse-pointer"><img class="loaction-icon" src="/bots-logo/sharelocation.png">'+e+' </div> <div class="message-time"> '+t+"</div></div></div></div>";$("#msg_block").append(o)}function I(e,t,n){var o='<div  class="row message-body"> <div class="col-sm-12 message-main-'+n+'"> <div class="'+n+'"> <div class="message-map mouse-pointer" data="'+e+'"><img class="map-img" src="/bots-logo/map.jpg"> </div> <div class="message-text"> الموقع على الخريطة</div> <div class="message-time"> '+t+"</div></div></div></div>";$("#msg_block").append(o)}function b(e){var t="";e.title.length>0&&(t="<h3>"+e.title+"</h3>"),"list"==e.type?t+="<ol>":"1"==e.main?t+="<ol class='smenu'>":t+="<ol class='menu'>";for(var n=0;n<e.options.length;n++)t+="<li>"+e.options[n]+"</li>";return t+="</ol>"}function S(e,t){return"ar"==t?"<div class = 'more'>"+e+"</div><div class = 'moreOptions'><span class='yes'>نعم</span><span class='no'>لا</span> </div>":"<div class = 'more'>"+e+"</div><div class = 'moreOptions'><span class='yes'>Yes</span><span class='no'>No</span> </div>"}function w(e){var t="";e.title.length>0&&(t="<h4>"+e.title+"</h4>"),t+="<div class='options-HB'>";for(var n=0;n<e.options.length;n++)t+="<span>"+e.options[n]+"</span>";return t+="</div>"}function k(e,t){var n="";e.title.length>0&&(n="<div>"+e.title+"</div>");var o=e.options.length;if(t){for(var a="",s=0;s<o;s++)a+="<i class='fa fa-star' aria-hidden='true' data-default='true' data-rating='1'></i>";n+="<div class='ratingContainer'><span class='xrating' data-current-rating=0 data-max-mark="+o+">"+a+"</span></div>"}else n+="<div class='ratingContainer'><span class='rating' data-current-rating=0 data-max-mark="+o+"></span></div>";return n}function y(e){return new Promise(t=>setTimeout(t,e))}async function C(e,t,n){var o,a,s="",i="",r=new Date,c=0,l=!1,d=0;e.Responses&&(d=e.Responses.length),t||await y(200),$("#typingIndicatorId").remove(),e.singleCard&&1==d&&(e.singleCard=0);for(var u=0;u<d;u++){var g=e.Responses[c];null==g.delay||t||e.singleCard||(h(),await y(1e3*g.delay)),$("#typingIndicatorId").remove(),"text"==g.type?(g.message=-1==(a=g.message).indexOf("<Emj id='")?a:a=(a=a.replace(new RegExp("<Emj id='1'/>","g"),"<img src='/plugins/Emojis/Emoji-1.png' style='width: 24px'/>")).replace(new RegExp("<Emj id='2'/>","g"),"<img src='/plugins/Emojis/Emoji-2.png' style='width: 24px'/>"),e.singleCard?i+=g.message:null!=g.mType&&"1"==g.mType?f(g.message,r.getHours()+":"+r.getMinutes(),"sender geo-sender"):v(g.message,r.getHours()+":"+r.getMinutes(),"sender",e.language),-1!=g.message.indexOf("لقد تمت عملية الدخول للحساب بنجاح")&&134==self.projectId&&(alawwalUser=e.AttachedProcess)):"options"==g.type||"list"==g.type?(null!=g.rating&&"1"==g.rating?(n&&(t=!1),s=k(g,t),l=!0):s=b(g),e.singleCard?i+=s:v(s,r.getHours()+":"+r.getMinutes(),"sender",e.language)):"optionsHB"==g.type?(s=w(g),e.singleCard?i+=s:v(s,r.getHours()+":"+r.getMinutes(),"sender",e.language)):"yesno"==g.type?(s=S(g.message,e.language),e.singleCard?i+=s:v(s,r.getHours()+":"+r.getMinutes(),"sender",e.language)):"image"==g.type&&(s=(o=g.template).hyperlink?"<div class = 'image-card'><a target='_blank' href='"+o.hyperlink+"'><img src='"+o.src+"' onload='scrollImg()'><h3>"+o.title+"</h3></a></div>":"<div class = 'image-card'><a target='_blank' href='"+o.src+"'><img src='"+o.src+"' onload='scrollImg()'><h3>"+o.title+"</h3></a></div>",e.singleCard?i+=s:v(s,r.getHours()+":"+r.getMinutes(),"sender",e.language)),c++}e.singleCard&&v(i,r.getHours()+":"+r.getMinutes(),"sender",e.language),p(),l&&!t||($("#msg_input").prop("disabled",!1),x()||$("#msg_input").focus()),t||setTimeout(function(){$("#conversation").getNiceScroll().resize()},400),l&&!t&&setTimeout(function(){$(".rating").magicRatingInit({success:function(e,t){$("#msg_input").prop("disabled",!1),x()||$("#msg_input").focus(),$("#msg_input").val(t),E(),$(".magic-rating-icon").removeClass("magic-rating-icon"),$(".ratingContainer .rating").addClass("xrating").removeClass("rating")}})},100)}function _(){var e=new Date;v("عذرا حدث خطأ في الاتصال...",e.getHours()+":"+e.getMinutes(),"sender","ar"),p(),$("#msg_input").prop("disabled",!1),x()||$("#msg_input").focus()}function B(){P("openConversation"),setTimeout(p,200)}function T(){$("#conversation").getNiceScroll().resize(),m()}function M(e){$("#custServiceConnectId").hide();var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200)}function E(){if(!e){$(".menu").removeClass("menu"),$(".moreOptions").addClass("hideOptions");var t=$("#msg_input").val().trim();if(-1!=t.toLowerCase().search("script")&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;")),$("#msg_input").height("22px"),""!=t){var n=new Date;v(t,n.getHours()+":"+n.getMinutes(),"receiver","ar"),p(),$("#conversation").getNiceScroll().resize(),$("#msg_input").val(""),"bot"==Bots.connectionMode&&(e=!0,$("#msg_input").prop("disabled",!0),setTimeout(function(){e=!1},3e3)),134==Bots.projectId&&$("#incompleted").show(),"bot"==Bots.connectionMode&&h(),Bots.sendMessage(t)}}}function x(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}if(!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime))if(window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition||null,SpeechRecognition){var O=new SpeechRecognition,H=document.getElementById("msg_input");O.addEventListener("result",function(e){H.textContent="";for(var t=e.resultIndex;t<e.results.length;t++)e.results[t].isFinal?(H.value=e.results[t][0].transcript,E(),O.stop(),$("#startSpeechId").show(),$("#stopSpeechId").hide()):H.value+=e.results[t][0].transcript}),O.addEventListener("error",function(e){e.message}),O.addEventListener("end",function(){}),$("#speechRecognationId").on("click","#startSpeechId",function(){H.textContent="";O.lang="ar-SA",O.continuous=!0,O.interimResults=!1;try{P("startrecognize"),O.start(),$("#startSpeechId").hide(),$("#stopSpeechId").show()}catch(e){e.message}}),document.getElementById("stopSpeechId").addEventListener("click",function(){O.stop(),$("#startSpeechId").show(),$("#stopSpeechId").hide()})}else document.querySelector(".js-api-support").removeAttribute("hidden"),document.querySelector(".js-api-info").setAttribute("hidden",""),[].forEach.call(document.querySelectorAll("form button"),function(e){e.setAttribute("disabled","")});else $("#speechRecognationId").on("click","#startSpeechId",function(){P("startrecognize")});var j,A,R,P=function(e){window.parent.postMessage(e,"*")};function D(){clearInterval(g_stopWatch),$("#generalSurveyId").addClass("hidepage"),$("#mapPageId").addClass("hidepage"),$("#captchaPageId").addClass("hidepage"),$("#chatbotModalId").removeClass("hidepage"),$("#captchaSectionId").show(),$("#timerSectionId").hide(),$("#msg_input").prop("disabled",!1),$("#msg_input").focus()}j=window,A="message",R=function(e){if("trackParentURL"==e.data)-1==e.origin.indexOf("alkhwarizmi.io")&&Bots.trackURL(e.origin);else if(-1!=e.data.indexOf("trackURL")){(n=e.data.split("#$#")).length>1&&Bots.trackURL(n[1])}else if(-1!=e.data.indexOf("open-widget")){var t="",n=e.data.split("#$#");Bots.lang=n[1],n.length>2&&(t=n[2],Bots.setParameter(t)),Bots.callWelcome(!1)}else if(-1!=e.data.indexOf("set-parameter")){t="";(n=e.data.split("#$#")).length>1&&(t=n[1],Bots.setParameter(t))}else if(-1!=e.data.indexOf("endrecognation")){(n=e.data.split("#$#")).length>1&&($("#msg_input").val(n[1]),E())}},j.addEventListener?j.addEventListener(A,R,!1):j.attachEvent&&j.attachEvent("on"+A,R),$("#sendMessage").click(function(){E(),$("#speechRecognationId").show(),$("#sendMessage").hide()}),$("#msg_input").keypress(function(e){13===e.which&&E()}),$("#custServiceConnectId").click(function(){Bots.closeCSConversation()}),$("#msg_input").on("keydown",function(e){var t=$(this);t.height(),t.scrollTop();t.scrollTop()&&$(this).height(function(e,t){return t+22})}),$("#msg_input").keyup(function(e){if(13!==e.which){var t=document.getElementById("msg_input");t.style.height="1px";var n=t.scrollHeight;t.clientHeight,t.scrollTop;t.style.height=n+"px",$("#msg_input").val().trim().length>0?($("#speechRecognationId").hide(),$("#sendMessage").show()):($("#speechRecognationId").show(),$("#sendMessage").hide())}else $("#msg_input").val("")}),$("#submitCaptchaId").click(function(){var e,t;e=$("#contact-form-name").val(),t=$("#contact-form-email").val(),$.ajax({type:"POST",url:"/api/bot/ResovleCaptcha",data:{name:e,email:t,userId:i,recaptcha:grecaptcha.getResponse()},success:function(e){"OK"==e&&($("#captchaSectionId").hide(),$("#timerSectionId").show(),stopWatch(600,document.querySelector("#time"),D))}})}),$("#msg_input").click(function(){$("#replaySectionId").addClass("active")}),$("#msg_input").focus(function(){$("#replaySectionId").addClass("active")}),$("#msg_input").blur(function(){$("#replaySectionId").removeClass("active"),0==$("#msg_input").val().trim().length&&($("#speechRecognationId").show(),$("#sendMessage").hide())}),$("#replaySectionId").click(function(){$("#replaySectionId").addClass("active"),$("#msg_input").focus()}),$(".msg_block").on("click",".smenu li",function(){$("#msg_input").val($(this).text()),E()}),$(".msg_block").on("click",".options-HB span",function(){$("#msg_input").val($(this).text()),$(".options-HB").addClass("hideOptions"),E()}),$(".msg_block").on("click",".menu li",function(){$("#msg_input").val($(this).text()),E(),$(".menu").removeClass("menu"),$(".moreOptions").addClass("hideOptions")}),$(".msg_block").on("click",".dmenu li",function(){$(this).attr("did");var e=$(this).attr("value");$("#msg_input").val(e),$(".dmenu").removeClass("dmenu"),E()}),$(".msg_block").on("click",".moreOptions span",function(){$("#msg_input").val($(this).text()),E(),$(".menu").removeClass("menu"),$(".moreOptions").addClass("hideOptions"),setTimeout(void document.getElementById("conversation"),2)}),$(".msg_block").on("click",".message-text a",function(e){"hyber"==$(this).attr("href")&&($("#msg_input").val($(this).text()),$(this).attr("src","hyber"),E(),e.preventDefault())}),$("#mainMenuId").click(function(){!function(e){if(147==e||150==e){$("#msg_input").val(""),$("#msg_input").prop("disabled",!0);var t="",n=new Date;147==e?t="<h3>الخدمات التي أؤديها :</h3><ul class='smenu'><li>أولا: الإجابة عن الاستفسارات المباشرة</li><li>ثانيا: التفاعل مع المشكلات&nbsp;</li><li>ثالثا: تنفيذ خدمات تفاعلية مع البنك</li><li>رابعا: التقدم بشكوى</li><li>خامسا: متابعة شكوى أو طلب</li></ul>":150==e&&(t="<h3>الخدمات التي أؤديها :</h3><ul class='smenu'><li>أولا: الإجابة عن الاستفسارات المباشرة</li><li>ثانيا: التفاعل مع المشكلات&nbsp;</li><li>ثالثا: تنفيذ خدمات تفاعلية مع البنك</li><li>رابعا: التقدم بشكوى</li><li>خامسا: متابعة شكوى أو طلب</li></ul>"),v(t,n.getHours()+":"+n.getMinutes(),"sender","ar"),p(),$("#msg_input").prop("disabled",!1),x()||$("#msg_input").focus()}}(r)}),$("#voiceCheckId").click(function(){t=!t}),$("#webFrameId").on("load",function(){var e=$("#webFrameId").contents().get(0).location.href;Bots.trackURL(e)}),$("#spashImageId").click(function(){$("#chatbotModalId").modal("show"),$(this).parent("#splashscreen").fadeOut(500)}),$(".msg_block").on("click",".geolocation",function(e){$("#generalSurveyId").addClass("hidepage"),$("#chatbotModalId").addClass("hidepage"),$("#captchaPageId").addClass("hidepage"),$("#mapPageId").removeClass("hidepage"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(u,g),s||(s=!0,$(".location-picker").locationPicker({locationChanged:function(e){o=e.location.lat,a=e.location.long},init:{current_location:!0}}))}),$("#cancelMapId").click(function(){$("#generalSurveyId").addClass("hidepage"),$("#captchaPageId").addClass("hidepage"),$("#mapPageId").addClass("hidepage"),$("#chatbotModalId").removeClass("hidepage")}),$("#acceptMapId").click(function(){$("#generalSurveyId").addClass("hidepage"),$("#captchaPageId").addClass("hidepage"),$("#mapPageId").addClass("hidepage"),$("#chatbotModalId").removeClass("hidepage"),function(t,n){if(!e){var o=new Date,a="geoLOC=["+t+","+n+"]";I(a,o.getHours()+":"+o.getMinutes(),"receiver"),p(),$("#conversation").getNiceScroll().resize(),e=!0,setTimeout(function(){e=!1},3e3),$("#msg_input").val(""),$("#msg_input").prop("disabled",!0),134==self.projectId&&$("#incompleted").show(),Bots.sendMessage(a)}}(o,a),$(".geolocation").removeClass("mouse-pointer"),$(".geolocation").removeClass("geolocation")}),Bots.init(i,r,c),Bots.on("handle-reponse",function(t,n){var o;e=!1,t=t.replace(/(\r\n\t|\n|\r\t)/gm,"");try{o=JSON.parse(t)}catch(e){return void _()}return null!=o.attacker&&1==o.attacker?($("#generalSurveyId").addClass("hidepage"),$("#chatbotModalId").addClass("hidepage"),$("#mapPageId").addClass("hidepage"),void $("#captchaPageId").removeClass("hidepage")):null!=o.Action&&1==o.Action?($("#typingIndicatorId").remove(),void Bots.customerService(!1,o.language)):(134==self.projectId&&null!=o.AttachedProcess&&-1!=o.AttachedProcess.indexOf("incompleted")&&(completedUserId=o.AttachedProcess.split("@@")[1],$("#bellId").attr("src","/bots-logo/abel.png"),$("#nofProcessId").show(),$("#incompleted").removeClass("disabled")),null!=o.serviceEvent&&P("service#$#"+o.serviceEvent),n&&B(),void(null!=o.Responses?(o.Responses.length>0&&o.Responses,C(o,!1,!1)):null!=o.conversation&&function(e){for(var t=new Date,n=0;n<e.conversation.length;n++){var o=e.conversation[n];if(null!=o.user&&(0==o.user.indexOf("geoLOC=[")||0==o.user.indexOf("geoloc=[")?I(o.user,t.getHours()+":"+t.getMinutes(),"receiver"):"welcome"==o.user||v(o.user,t.getHours()+":"+t.getMinutes(),"receiver",e.language),$("#msg_input").prop("disabled",!1),x()||$("#msg_input").focus()),null!=o.bot){if("1"==o.bot.singleCard?o.bot.singleCard=1:o.bot.singleCard=0,n!=e.conversation.length-1)for(var a=0;a<o.bot.Responses.length;a++){var s=o.bot.Responses[a];"text"==s.type&&null!=s.mType&&"1"==s.mType&&(s.mType="0")}lastItem=!1,n==e.conversation.length-1&&(lastItem=!0),C(o.bot,!0,lastItem),n!=e.conversation.length-1&&$(".moreOptions").addClass("hideOptions")}n!=e.conversation.length-1&&$(".menu").removeClass("menu")}setTimeout(m,200),setTimeout(function(){$("#conversation").getNiceScroll().resize()},400)}(o)))}),Bots.on("handle-tracked-url",function(e){var t;e=e.replace(/(\r\n\t|\n|\r\t)/gm,"");try{t=JSON.parse(e)}catch(e){return void _()}if(null!=t.Responses){if(t.Responses.length>0&&"NoAction"==t.Responses[0].message)return;B(),C(t,!1,!1),setTimeout(T,400)}}),Bots.on("agent-try-connect",function(){$("#custServiceConnectId").show(),$("#msg_input").prop("disabled",!1)}),Bots.on("start-room",function(e){var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200)}),Bots.on("add-message",function(e){var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200)}),Bots.on("close-room",function(e){$("#custServiceConnectId").hide();var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200)}),Bots.on("close-new-request",function(e){var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200)}),Bots.on("room-diconnect",function(e){var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200),setTimeout(function(){},6e4)}),Bots.on("agent-not-avaliable",M),Bots.on("request-rejected",M),Bots.on("request-added",function(e){var t=new Date;v(e,t.getHours()+":"+t.getMinutes(),"employee","ar"),p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},200)}),Bots.on("display-department",function(e,t){if(1==e.status&&null!=e.departments){for(var n="<ol class='dmenu'>",o="",a=0;a<e.departments.length;a++){o=e.departments[a].names[0].value;for(var s=0;s<e.departments[a].names.length;s++)if(e.departments[a].names[s].lang==t){o=e.departments[a].names[s].value;break}n+="<li value='"+o+"' dId='"+e.departments[a]._id+"' >"+o+"</li>"}n+="</ol>";var i=new Date;v("الرجاء اختيار القسم من القائمة:",i.getHours()+":"+i.getMinutes(),"sender","en"),v(n,i.getHours()+":"+i.getMinutes(),"sender","en"),Bots.connectionMode="department"}else 2==e.status&&null!=e.departments?Bots.connectWithAgent(e.departments[0]._id,e.departments[0].names[0].value):Bots.connectWithAgent("default","default");p(),setTimeout(function(){$("#conversation").getNiceScroll().resize()},400)}),Bots.on("net-connection-error",function(){var e=new Date;v("عذرا، هناك عطل في الاتصال بالإنترنت ...",e.getHours()+":"+e.getMinutes(),"sender","ar"),p(),$("#msg_input").prop("disabled",!1),x()||$("#msg_input").focus()}),Bots.on("clear-conversation",function(){$("#msg_block").empty()})});